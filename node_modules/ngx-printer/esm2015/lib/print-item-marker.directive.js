import { Directive, ElementRef, Renderer2, Input, Output, EventEmitter, } from '@angular/core';
import { NgxPrinterService } from './ngx-printer.service';
import { ngxPrintMarkerPosition } from './ngx-print-marker-position.enum';
/**
 * Mark an div as printable and provide direct print function
 */
export class PrintItemMarkerDirective {
    constructor(el, renderer2, printerService) {
        this.el = el;
        this.renderer2 = renderer2;
        this.printerService = printerService;
        this.customClass = '';
        this.directPrint = false;
        this.imgPosition = ngxPrintMarkerPosition.Topleft;
        /**
         * Data for an svg image used as background url
         * @example
         * backgroundImage = 'data:image/svg+xml;base64,PD9....'
         *
         */
        this.backgroundImage = 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNy4xLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB2aWV3Qm94PSIwIDAgNTAgNTAiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDUwIDUwIiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxwYXRoIGQ9Ik0zOS4zODcsMjEuNDcxSDMyLjI5VjExLjE5OWMwLTAuNTUzLTAuNDQ3LTEtMS0xSDE3LjQ4NGMtMC41NTMsMC0xLDAuNDQ3LTEsMXYxMC4yNzFIOS4zODdjLTAuNTUzLDAtMSwwLjQ0Ny0xLDFWMzUuNDUNCgljMCwwLjU1MywwLjQ0NywxLDEsMWg2Ljg5NHYzLjU2NWMwLDAuNTUzLDAuNDQ3LDEsMSwxaDEzLjgwNmMwLjU1MywwLDEtMC40NDcsMS0xVjM2LjQ1aDcuMzAxYzAuNTUzLDAsMS0wLjQ0NywxLTFWMjIuNDcxDQoJQzQwLjM4NywyMS45MTgsMzkuOTM5LDIxLjQ3MSwzOS4zODcsMjEuNDcxeiBNMTguNDg0LDEyLjE5OUgzMC4yOXY5LjI3MUgxOC40ODRWMTIuMTk5eiBNMzAuMDg2LDM5LjAxNkgxOC4yOHYtNi4zMjloMTEuODA2VjM5LjAxNg0KCXogTTM4LjM4NywzNC40NWgtNi4zMDF2LTIuNzY0YzAtMC41NTMtMC40NDctMS0xLTFIMTcuMjhjLTAuNTUzLDAtMSwwLjQ0Ny0xLDF2Mi43NjRoLTUuODk0VjIzLjQ3MWg2Ljg5NA0KCWMwLjA2OCwwLjAxNCwwLjEzMSwwLjA0MSwwLjIwMywwLjA0MUgzMS4yOWMwLjA3MiwwLDAuMTM2LTAuMDI3LDAuMjAzLTAuMDQxaDYuODkzVjM0LjQ1eiIvPg0KPC9zdmc+DQo=';
        this.imgMainStyles = {
            'background-color': '#c3c3b6',
            height: '16px',
            width: '16px',
            position: 'absolute',
            cursor: 'pointer'
        };
        this.imgPositionTopLeft = {
            left: '1px',
            top: '1px',
        };
        this.imgPositionTopRight = {
            right: '1px',
            top: '1px',
        };
        this.imgPositionBottomLeft = {
            left: '1px',
            bottom: '1px',
        };
        this.imgPositionBottomRight = {
            right: '1px',
            bottom: '1px',
        };
        /**
         * Event fired when marker clicked
         * @emits
         */
        this.printClicked = new EventEmitter();
    }
    ngOnInit() {
        const newIndicator = document.createElement('div');
        this.imgPosition = this.printerService.markerPosition;
        this.addIndicatorDiv(this.el, newIndicator);
        newIndicator.addEventListener('click', () => {
            if (this.directPrint) {
                const elementToPrint = this.el.nativeElement.getElementsByClassName('print_indicator');
                if (elementToPrint && elementToPrint.length > 0) {
                    this.renderer2.setStyle(elementToPrint[0], 'visibility', 'hidden');
                    this.printerService.printHTMLElement(this.el.nativeElement);
                    this.renderer2.setStyle(elementToPrint[0], 'visibility', 'visible');
                }
                else {
                    console.log('element with indicator class not found..');
                }
            }
            this.printClicked.emit(true);
        });
    }
    /**
     * Change and add div with Indicator
     * @param el
     * @param newIndicator
     */
    addIndicatorDiv(el, newIndicator) {
        const natElement = el.nativeElement;
        this.renderer2.addClass(newIndicator, 'print_indicator');
        this.renderer2.setStyle(natElement, 'position', 'relative');
        this.renderer2.appendChild(el.nativeElement, newIndicator);
        if (this.customClass === '') {
            this.setCss(newIndicator);
        }
        else {
            this.renderer2.addClass(newIndicator, this.customClass);
        }
    }
    /**
     * Set the default css properties
     * @param newIndicator
     */
    setCss(newIndicator) {
        Object.keys(this.imgMainStyles).forEach((element) => {
            newIndicator.style.setProperty(`${element}`, this.imgMainStyles[element]);
        });
        this.setPosition(newIndicator);
        const imgUrl = 'url(' + this.backgroundImage + ')';
        newIndicator.style.setProperty(`background-image`, imgUrl);
    }
    /**
     * Set image position
     * @internal
     * @param newIndicator
     */
    setPosition(newIndicator) {
        switch (this.imgPosition) {
            case ngxPrintMarkerPosition.Topleft: {
                Object.keys(this.imgPositionTopLeft).forEach((element) => {
                    newIndicator.style.setProperty(`${element}`, this.imgPositionTopLeft[element]);
                });
                break;
            }
            case ngxPrintMarkerPosition.TopRight: {
                Object.keys(this.imgPositionTopRight).forEach((element) => {
                    newIndicator.style.setProperty(`${element}`, this.imgPositionTopRight[element]);
                });
                break;
            }
            case ngxPrintMarkerPosition.BottomLeft: {
                Object.keys(this.imgPositionBottomLeft).forEach((element) => {
                    newIndicator.style.setProperty(`${element}`, this.imgPositionBottomLeft[element]);
                });
                break;
            }
            case ngxPrintMarkerPosition.BottomRight: {
                Object.keys(this.imgPositionBottomRight).forEach((element) => {
                    newIndicator.style.setProperty(`${element}`, this.imgPositionBottomRight[element]);
                });
                break;
            }
            default: {
                Object.keys(this.imgPositionTopLeft).forEach((element) => {
                    newIndicator.style.setProperty(`${element}`, this.imgPositionTopLeft[element]);
                });
                break;
            }
        }
    }
}
PrintItemMarkerDirective.decorators = [
    { type: Directive, args: [{
                selector: '[ngxPrintItemMarker]',
            },] }
];
PrintItemMarkerDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: NgxPrinterService }
];
PrintItemMarkerDirective.propDecorators = {
    customClass: [{ type: Input }],
    directPrint: [{ type: Input }],
    imgPosition: [{ type: Input }],
    backgroundImage: [{ type: Input }],
    printClicked: [{ type: Output }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJpbnQtaXRlbS1tYXJrZXIuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvbmd4LXByaW50ZXIvc3JjL2xpYi9wcmludC1pdGVtLW1hcmtlci5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCxVQUFVLEVBQ1YsU0FBUyxFQUVULEtBQUssRUFDTCxNQUFNLEVBQ04sWUFBWSxHQUNiLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQzFELE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLGtDQUFrQyxDQUFDO0FBRzFFOztHQUVHO0FBSUgsTUFBTSxPQUFPLHdCQUF3QjtJQXVEbkMsWUFDVSxFQUFjLEVBQ2QsU0FBb0IsRUFDcEIsY0FBaUM7UUFGakMsT0FBRSxHQUFGLEVBQUUsQ0FBWTtRQUNkLGNBQVMsR0FBVCxTQUFTLENBQVc7UUFDcEIsbUJBQWMsR0FBZCxjQUFjLENBQW1CO1FBeEQzQyxnQkFBVyxHQUFHLEVBQUUsQ0FBQztRQUdqQixnQkFBVyxHQUFHLEtBQUssQ0FBQztRQUdwQixnQkFBVyxHQUFHLHNCQUFzQixDQUFDLE9BQU8sQ0FBQztRQUU3Qzs7Ozs7V0FLRztRQUVILG9CQUFlLEdBQ2IsbzNDQUFvM0MsQ0FBQztRQUV2M0Msa0JBQWEsR0FBRztZQUNkLGtCQUFrQixFQUFFLFNBQVM7WUFDN0IsTUFBTSxFQUFFLE1BQU07WUFDZCxLQUFLLEVBQUUsTUFBTTtZQUNiLFFBQVEsRUFBRSxVQUFVO1lBQ3BCLE1BQU0sRUFBRSxTQUFTO1NBQ2xCLENBQUM7UUFFRix1QkFBa0IsR0FBRztZQUNuQixJQUFJLEVBQUUsS0FBSztZQUNYLEdBQUcsRUFBRSxLQUFLO1NBQ1gsQ0FBQztRQUVGLHdCQUFtQixHQUFHO1lBQ3BCLEtBQUssRUFBRSxLQUFLO1lBQ1osR0FBRyxF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QUFDLENBQUM7Z0JBQ0gsTUFBTTthQUNQO1lBQ0QsS0FBSyxzQkFBc0IsQ0FBQyxXQUFXLENBQUMsQ0FBQztnQkFDdkMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRTtvQkFDM0QsWUFBWSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQzVCLEdBQUcsT0FBTyxFQUFFLEVBQ1osSUFBSSxDQUFDLHNCQUFzQixDQUFDLE9BQU8sQ0FBQyxDQUNyQyxDQUFDO2dCQUNKLENBQUMsQ0FBQyxDQUFDO2dCQUNILE1BQU07YUFDUDtZQUNELE9BQU8sQ0FBQyxDQUFDO2dCQUNQLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsT0FBTyxFQUFFLEVBQUU7b0JBQ3ZELFlBQVksQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUM1QixHQUFHLE9BQU8sRUFBRSxFQUNaLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxPQUFPLENBQUMsQ0FDakMsQ0FBQztnQkFDSixDQUFDLENBQUMsQ0FBQztnQkFDSCxNQUFNO2FBQ1A7U0FDRjtJQUNILENBQUM7OztZQTdLRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLHNCQUFzQjthQUNqQzs7O1lBaEJDLFVBQVU7WUFDVixTQUFTO1lBTUYsaUJBQWlCOzs7MEJBV3ZCLEtBQUs7MEJBR0wsS0FBSzswQkFHTCxLQUFLOzhCQVNMLEtBQUs7MkJBb0NMLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gIERpcmVjdGl2ZSxcclxuICBFbGVtZW50UmVmLFxyXG4gIFJlbmRlcmVyMixcclxuICBPbkluaXQsXHJcbiAgSW5wdXQsXHJcbiAgT3V0cHV0LFxyXG4gIEV2ZW50RW1pdHRlcixcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgTmd4UHJpbnRlclNlcnZpY2UgfSBmcm9tICcuL25neC1wcmludGVyLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBuZ3hQcmludE1hcmtlclBvc2l0aW9uIH0gZnJvbSAnLi9uZ3gtcHJpbnQtbWFya2VyLXBvc2l0aW9uLmVudW0nO1xyXG5cclxuXHJcbi8qKlxyXG4gKiBNYXJrIGFuIGRpdiBhcyBwcmludGFibGUgYW5kIHByb3ZpZGUgZGlyZWN0IHByaW50IGZ1bmN0aW9uXHJcbiAqL1xyXG5ARGlyZWN0aXZlKHtcclxuICBzZWxlY3RvcjogJ1tuZ3hQcmludEl0ZW1NYXJrZXJdJyxcclxufSlcclxuZXhwb3J0IGNsYXNzIFByaW50SXRlbU1hcmtlckRpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcbiAgQElucHV0KClcclxuICBjdXN0b21DbGFzcyA9ICcnO1xyXG5cclxuICBASW5wdXQoKVxyXG4gIGRpcmVjdFByaW50ID0gZmFsc2U7XHJcblxyXG4gIEBJbnB1dCgpXHJcbiAgaW1nUG9zaXRpb24gPSBuZ3hQcmludE1hcmtlclBvc2l0aW9uLlRvcGxlZnQ7XHJcblxyXG4gIC8qKlxyXG4gICAqIERhdGEgZm9yIGFuIHN2ZyBpbWFnZSB1c2VkIGFzIGJhY2tncm91bmQgdXJsXHJcbiAgICogQGV4YW1wbGVcclxuICAgKiBiYWNrZ3JvdW5kSW1hZ2UgPSAnZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQRDkuLi4uJ1xyXG4gICAqXHJcbiAgICovXHJcbiAgQElucHV0KClcclxuICBiYWNrZ3JvdW5kSW1hZ2UgPVxyXG4gICAgJ2RhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEQ5NGJXd2dkbVZ5YzJsdmJqMGlNUzR3SWlCbGJtTnZaR2x1WnowaWRYUm1MVGdpUHo0TkNqd2hMUzBnUjJWdVpYSmhkRzl5T2lCQlpHOWlaU0JKYkd4MWMzUnlZWFJ2Y2lBeE55NHhMakFzSUZOV1J5QkZlSEJ2Y25RZ1VHeDFaeTFKYmlBdUlGTldSeUJXWlhKemFXOXVPaUEyTGpBd0lFSjFhV3hrSURBcElDQXRMVDROQ2p3aFJFOURWRmxRUlNCemRtY2dVRlZDVEVsRElDSXRMeTlYTTBNdkwwUlVSQ0JUVmtjZ01TNHhMeTlGVGlJZ0ltaDBkSEE2THk5M2QzY3Vkek11YjNKbkwwZHlZWEJvYVdOekwxTldSeTh4TGpFdlJGUkVMM04yWnpFeExtUjBaQ0krRFFvOGMzWm5JSFpsY25OcGIyNDlJakV1TVNJZ2FXUTlJa3hoZVdWeVh6RWlJSGh0Ykc1elBTSm9kSFJ3T2k4dmQzZDNMbmN6TG05eVp5OHlNREF3TDNOMlp5SWdlRzFzYm5NNmVHeHBibXM5SW1oMGRIQTZMeTkzZDNjdWR6TXViM0puTHpFNU9Ua3ZlR3hwYm1zaUlIZzlJakJ3ZUNJZ2VUMGlNSEI0SWcwS0NTQjJhV1YzUW05NFBTSXdJREFnTlRBZ05UQWlJR1Z1WVdKc1pTMWlZV05yWjNKdmRXNWtQU0p1WlhjZ01DQXdJRFV3SURVd0lpQjRiV3c2YzNCaFkyVTlJbkJ5WlhObGNuWmxJajROQ2p4d1lYUm9JR1E5SWswek9TNHpPRGNzTWpFdU5EY3hTRE15TGpJNVZqRXhMakU1T1dNd0xUQXVOVFV6TFRBdU5EUTNMVEV0TVMweFNERTNMalE0TkdNdE1DNDFOVE1zTUMweExEQXVORFEzTFRFc01YWXhNQzR5TnpGSU9TNHpPRGRqTFRBdU5UVXpMREF0TVN3d0xqUTBOeTB4TERGV016VXVORFVOQ2dsak1Dd3dMalUxTXl3d0xqUTBOeXd4TERFc01XZzJMamc1TkhZekxqVTJOV013TERBdU5UVXpMREF1TkRRM0xERXNNU3d4YURFekxqZ3dObU13TGpVMU15d3dMREV0TUM0ME5EY3NNUzB4VmpNMkxqUTFhRGN1TXpBeFl6QXVOVFV6TERBc01TMHdMalEwTnl3eExURldNakl1TkRjeERRb0pRelF3TGpNNE55d3lNUzQ1TVRnc016a3VPVE01TERJeExqUTNNU3d6T1M0ek9EY3NNakV1TkRjeGVpQk5NVGd1TkRnMExERXlMakU1T1Vnek1DNHlPWFk1TGpJM01VZ3hPQzQwT0RSV01USXVNVGs1ZWlCTk16QXVNRGcyTERNNUxqQXhOa2d4T0M0eU9IWXROaTR6TWpsb01URXVPREEyVmpNNUxqQXhOZzBLQ1hvZ1RUTTRMak00Tnl3ek5DNDBOV2d0Tmk0ek1ERjJMVEl1TnpZMFl6QXRNQzQxTlRNdE1DNDBORGN0TVMweExURklNVGN1TWpoakxUQXVOVFV6TERBdE1Td3dMalEwTnkweExERjJNaTQzTmpSb0xUVXVPRGswVmpJekxqUTNNV2cyTGpnNU5BMEtDV013TGpBMk9Dd3dMakF4TkN3d0xqRXpNU3d3TGpBME1Td3dMakl3TXl3d0xqQTBNVWd6TVM0eU9XTXdMakEzTWl3d0xEQXVNVE0yTFRBdU1ESTNMREF1TWpBekxUQXVNRFF4YURZdU9Ea3pWak0wTGpRMWVpSXZQZzBLUEM5emRtYytEUW89JztcclxuXHJcbiAgaW1nTWFpblN0eWxlcyA9IHtcclxuICAgICdiYWNrZ3JvdW5kLWNvbG9yJzogJyNjM2MzYjYnLFxyXG4gICAgaGVpZ2h0OiAnMTZweCcsXHJcbiAgICB3aWR0aDogJzE2cHgnLFxyXG4gICAgcG9zaXRpb246ICdhYnNvbHV0ZScsXHJcbiAgICBjdXJzb3I6ICdwb2ludGVyJ1xyXG4gIH07XHJcblxyXG4gIGltZ1Bvc2l0aW9uVG9wTGVmdCA9IHtcclxuICAgIGxlZnQ6ICcxcHgnLFxyXG4gICAgdG9wOiAnMXB4JyxcclxuICB9O1xyXG5cclxuICBpbWdQb3NpdGlvblRvcFJpZ2h0ID0ge1xyXG4gICAgcmlnaHQ6ICcxcHgnLFxyXG4gICAgdG9wOiAnMXB4JyxcclxuICB9O1xyXG5cclxuICBpbWdQb3NpdGlvbkJvdHRvbUxlZnQgPSB7XHJcbiAgICBsZWZ0OiAnMXB4JyxcclxuICAgIGJvdHRvbTogJzFweCcsXHJcbiAgfTtcclxuXHJcbiAgaW1nUG9zaXRpb25Cb3R0b21SaWdodCA9IHtcclxuICAgIHJpZ2h0OiAnMXB4JyxcclxuICAgIGJvdHRvbTogJzFweCcsXHJcbiAgfTtcclxuXHJcbiAgLyoqXHJcbiAgICogRXZlbnQgZmlyZWQgd2hlbiBtYXJrZXIgY2xpY2tlZFxyXG4gICAqIEBlbWl0c1xyXG4gICAqL1xyXG4gIEBPdXRwdXQoKVxyXG4gIHByaW50Q2xpY2tlZCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgZWw6IEVsZW1lbnRSZWYsXHJcbiAgICBwcml2YXRlIHJlbmRlcmVyMjogUmVuZGVyZXIyLFxyXG4gICAgcHJpdmF0ZSBwcmludGVyU2VydmljZTogTmd4UHJpbnRlclNlcnZpY2VcclxuICApIHt9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgY29uc3QgbmV3SW5kaWNhdG9yID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICB0aGlzLmltZ1Bvc2l0aW9uID0gdGhpcy5wcmludGVyU2VydmljZS5tYXJrZXJQb3NpdGlvbjtcclxuXHJcbiAgICB0aGlzLmFkZEluZGljYXRvckRpdih0aGlzLmVsLCBuZXdJbmRpY2F0b3IpO1xyXG5cclxuICAgIG5ld0luZGljYXRvci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcclxuICAgICAgaWYgKHRoaXMuZGlyZWN0UHJpbnQpIHtcclxuICAgICAgICBjb25zdCBlbGVtZW50VG9QcmludCA9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFxyXG4gICAgICAgICAgJ3ByaW50X2luZGljYXRvcidcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICBpZiAoZWxlbWVudFRvUHJpbnQgJiYgZWxlbWVudFRvUHJpbnQubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgdGhpcy5yZW5kZXJlcjIuc2V0U3R5bGUoZWxlbWVudFRvUHJpbnRbMF0sICd2aXNpYmlsaXR5JywgJ2hpZGRlbicpO1xyXG4gICAgICAgICAgdGhpcy5wcmludGVyU2VydmljZS5wcmludEhUTUxFbGVtZW50KHRoaXMuZWwubmF0aXZlRWxlbWVudCk7XHJcbiAgICAgICAgICB0aGlzLnJlbmRlcmVyMi5zZXRTdHlsZShlbGVtZW50VG9QcmludFswXSwgJ3Zpc2liaWxpdHknLCAndmlzaWJsZScpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZygnZWxlbWVudCB3aXRoIGluZGljYXRvciBjbGFzcyBub3QgZm91bmQuLicpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICB0aGlzLnByaW50Q2xpY2tlZC5lbWl0KHRydWUpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDaGFuZ2UgYW5kIGFkZCBkaXYgd2l0aCBJbmRpY2F0b3JcclxuICAgKiBAcGFyYW0gZWxcclxuICAgKiBAcGFyYW0gbmV3SW5kaWNhdG9yXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhZGRJbmRpY2F0b3JEaXYoZWw6IEVsZW1lbnRSZWY8YW55PiwgbmV3SW5kaWNhdG9yOiBIVE1MRGl2RWxlbWVudCkge1xyXG4gICAgY29uc3QgbmF0RWxlbWVudCA9IGVsLm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICB0aGlzLnJlbmRlcmVyMi5hZGRDbGFzcyhuZXdJbmRpY2F0b3IsICdwcmludF9pbmRpY2F0b3InKTtcclxuICAgIHRoaXMucmVuZGVyZXIyLnNldFN0eWxlKG5hdEVsZW1lbnQsICdwb3NpdGlvbicsICdyZWxhdGl2ZScpO1xyXG4gICAgdGhpcy5yZW5kZXJlcjIuYXBwZW5kQ2hpbGQoZWwubmF0aXZlRWxlbWVudCwgbmV3SW5kaWNhdG9yKTtcclxuICAgIGlmICh0aGlzLmN1c3RvbUNsYXNzID09PSAnJykge1xyXG4gICAgICB0aGlzLnNldENzcyhuZXdJbmRpY2F0b3IpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5yZW5kZXJlcjIuYWRkQ2xhc3MobmV3SW5kaWNhdG9yLCB0aGlzLmN1c3RvbUNsYXNzKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNldCB0aGUgZGVmYXVsdCBjc3MgcHJvcGVydGllc1xyXG4gICAqIEBwYXJhbSBuZXdJbmRpY2F0b3JcclxuICAgKi9cclxuICBwcml2YXRlIHNldENzcyhuZXdJbmRpY2F0b3I6IEhUTUxEaXZFbGVtZW50KSB7XHJcbiAgICBPYmplY3Qua2V5cyh0aGlzLmltZ01haW5TdHlsZXMpLmZvckVhY2goKGVsZW1lbnQpID0+IHtcclxuICAgICAgbmV3SW5kaWNhdG9yLnN0eWxlLnNldFByb3BlcnR5KGAke2VsZW1lbnR9YCwgdGhpcy5pbWdNYWluU3R5bGVzW2VsZW1lbnRdKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRoaXMuc2V0UG9zaXRpb24obmV3SW5kaWNhdG9yKTtcclxuXHJcbiAgICBjb25zdCBpbWdVcmwgPSAndXJsKCcgKyB0aGlzLmJhY2tncm91bmRJbWFnZSArICcpJztcclxuICAgIG5ld0luZGljYXRvci5zdHlsZS5zZXRQcm9wZXJ0eShgYmFja2dyb3VuZC1pbWFnZWAsIGltZ1VybCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXQgaW1hZ2UgcG9zaXRpb25cclxuICAgKiBAaW50ZXJuYWxcclxuICAgKiBAcGFyYW0gbmV3SW5kaWNhdG9yXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzZXRQb3NpdGlvbihuZXdJbmRpY2F0b3I6IEhUTUxEaXZFbGVtZW50KSB7XHJcbiAgICBzd2l0Y2ggKHRoaXMuaW1nUG9zaXRpb24pIHtcclxuICAgICAgY2FzZSBuZ3hQcmludE1hcmtlclBvc2l0aW9uLlRvcGxlZnQ6IHtcclxuICAgICAgICBPYmplY3Qua2V5cyh0aGlzLmltZ1Bvc2l0aW9uVG9wTGVmdCkuZm9yRWFjaCgoZWxlbWVudCkgPT4ge1xyXG4gICAgICAgICAgbmV3SW5kaWNhdG9yLnN0eWxlLnNldFByb3BlcnR5KFxyXG4gICAgICAgICAgICBgJHtlbGVtZW50fWAsXHJcbiAgICAgICAgICAgIHRoaXMuaW1nUG9zaXRpb25Ub3BMZWZ0W2VsZW1lbnRdXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICAgIGNhc2Ugbmd4UHJpbnRNYXJrZXJQb3NpdGlvbi5Ub3BSaWdodDoge1xyXG4gICAgICAgIE9iamVjdC5rZXlzKHRoaXMuaW1nUG9zaXRpb25Ub3BSaWdodCkuZm9yRWFjaCgoZWxlbWVudCkgPT4ge1xyXG4gICAgICAgICAgbmV3SW5kaWNhdG9yLnN0eWxlLnNldFByb3BlcnR5KFxyXG4gICAgICAgICAgICBgJHtlbGVtZW50fWAsXHJcbiAgICAgICAgICAgIHRoaXMuaW1nUG9zaXRpb25Ub3BSaWdodFtlbGVtZW50XVxyXG4gICAgICAgICAgKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgICBjYXNlIG5neFByaW50TWFya2VyUG9zaXRpb24uQm90dG9tTGVmdDoge1xyXG4gICAgICAgIE9iamVjdC5rZXlzKHRoaXMuaW1nUG9zaXRpb25Cb3R0b21MZWZ0KS5mb3JFYWNoKChlbGVtZW50KSA9PiB7XHJcbiAgICAgICAgICBuZXdJbmRpY2F0b3Iuc3R5bGUuc2V0UHJvcGVydHkoXHJcbiAgICAgICAgICAgIGAke2VsZW1lbnR9YCxcclxuICAgICAgICAgICAgdGhpcy5pbWdQb3NpdGlvbkJvdHRvbUxlZnRbZWxlbWVudF1cclxuICAgICAgICAgICk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgICAgY2FzZSBuZ3hQcmludE1hcmtlclBvc2l0aW9uLkJvdHRvbVJpZ2h0OiB7XHJcbiAgICAgICAgT2JqZWN0LmtleXModGhpcy5pbWdQb3NpdGlvbkJvdHRvbVJpZ2h0KS5mb3JFYWNoKChlbGVtZW50KSA9PiB7XHJcbiAgICAgICAgICBuZXdJbmRpY2F0b3Iuc3R5bGUuc2V0UHJvcGVydHkoXHJcbiAgICAgICAgICAgIGAke2VsZW1lbnR9YCxcclxuICAgICAgICAgICAgdGhpcy5pbWdQb3NpdGlvbkJvdHRvbVJpZ2h0W2VsZW1lbnRdXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICAgIGRlZmF1bHQ6IHtcclxuICAgICAgICBPYmplY3Qua2V5cyh0aGlzLmltZ1Bvc2l0aW9uVG9wTGVmdCkuZm9yRWFjaCgoZWxlbWVudCkgPT4ge1xyXG4gICAgICAgICAgbmV3SW5kaWNhdG9yLnN0eWxlLnNldFByb3BlcnR5KFxyXG4gICAgICAgICAgICBgJHtlbGVtZW50fWAsXHJcbiAgICAgICAgICAgIHRoaXMuaW1nUG9zaXRpb25Ub3BMZWZ0W2VsZW1lbnRdXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdfQ==